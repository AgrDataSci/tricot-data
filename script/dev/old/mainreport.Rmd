---
title: "Common bean on-farm trials in Tanzania"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: 
  word_document:
    reference_docx: word_style_template.docx
    toc: true
  html_document:
    toc: true
  pdf_document:
    toc: true
bibliography: ["climmob.bib"]
csl: citation_style.csl
---

```{r setup_opts, include=FALSE}
knitr::opts_chunk$set(echo = FALSE,
                      error = FALSE,
                      message=FALSE,
                      warning = FALSE)
```


# Introduction  

This report presents the results from your tricot experiment, offering insights into the performance of the technologies tested in the experiment. Designed as a standard automated report, it highlights the most critical outputs from your tricot experiment, leveraging farmer-generated data to ensure relevance and reliability. By reviewing this report, you will be able to: (i) identify which technology outperforms others across diverse conditions and farmer contexts, and (ii) make informed decisions about advancing a technology to the next stage of your product development pipeline (e.g., breeding program, market assessment). This report reflects the tricot approach’s strength in providing actionable, farmer-centered insights that support scalable, demand-driven innovation.

# Methods

We applied the Plackett-Luce (PL) model, originally proposed independently by Luce (1959) [@Luce1959] and Plackett (1975) [@Plackett1975], to analyze ranking data. This model is implemented in R through the PlackettLuce package [@Turner2020]. The Plackett-Luce model estimates the relative importance or probability of outperforming among different technologies, adhering to Luce’s Choice Axiom [@Luce1959]. This axiom asserts that the probability of one item (e.g., variety) outperforming another is independent of the presence or absence of other items in the set, enabling robust and context-independent comparisons.

Equation [1]

$$P (i \succ j) = \frac{p_i}{p_i + p_j}$$

where $p_i$ is a positive real-valued score assigned to individual $i$. The comparison $i \succ j$ can be read as "$i$ is preferred over $j$".

The PL model determines the values of positive-valued parameters $\alpha_i$ (*worth*) associated with each item $i$. These parameters $\alpha$ are related to the probability ($P$) that item $i$ outperforms all other $n$ items in the set. 

Your tricot experiment used rankings of three technologies $(i \succ j \succ k)$, which have the following probability of occurring according to the PL model:

Equation [2]

$$P(i \succ j \succ k) = P(i \succ {j,k}) \cdot P(j \succ k)$$

he correlation between 'overall preference' and other traits is estimated using the Kendall tau coefficient [@Kendall1938]. This coefficient, a non-parametric equivalent to the Pearson correlation, is specifically designed for ranking data. It ranges from -1 to 1, where 1 indicates perfect positive correlation and -1 indicates perfect negative correlation. This method is particularly useful for identifying the drivers behind participants' choices and for prioritizing traits to test in the next stage of tricot experiments, ensuring that future efforts are aligned with key farmer preferences and priorities.

This report is generated in R [@RCoreTeam] using the R packages 'knitr' [@knitr] and 'rmarkdown' [@rmarkdown]. Organizing the data relies on packages 'ClimMobTools' [@climmobtools], 'gosset' [@gosset], 'gtools' [@gtools], 'jsonlite' [@jsonlite], 'partykit' [@partykit], 'psychotools' [@psychotools] and 'qvcalc' [@qvcalc]. Summaries and data visualization are supported by packages 'igraph' [@igraph], 'ggparty' [@ggparty], 'ggplot2' [@ggplot2], 'ggrepel' [@ggrepel], 'gridExtra' [@gridExtra] 'leaflet' [@leaflet], 'multcompView' [@multcompView], 'patchwork' [@patchwork], 'png' [@png], 'plotrix' [@plotrix] and 'pls' [@pls]. The decentralized experimental approach behind ClimMob is introduced by van Etten et al. (2019) [@vanEtten2019tricot]. To cite ClimMob itself, mention van Etten et al. (2020) [@climmob]. The workflow used to produce this report is documented by de Sousa et al. (2022) [@climmobanalysis].


\pagebreak

# Trial overview

The map below shows the distribution of the plots in this experiment.

```{r map, out.width = '100%', fig.cap=paste0("Fig. 1. Distribution of trial plots.")}
knitr::include_graphics("/Users/kauedesousa/Library/Mobile Documents/com~apple~CloudDocs/Work/Rcode/tricot-data-v1/output/bean-eastafrica/Rplot.png")
```

Figure 2 provides a graphical representation of the experimental design, illustrating whether all varieties are interconnected within the experiment network. A fully connected network indicates that all varieties co-occurred at least once within an incomplete block of 3. The network structure is derived from the rankings generated based on overall preference, ensuring the visualization reflects the relationships informed by participant preferences.

```{r trial_network,  fig.cap=paste0("Figure 2. Experimental network representation of varieties tested in this experiment. Arrows indicate direct paths of wins and losses between each pair of variety indicating that they co-occur in at least one experimental block.")}
knitr::include_graphics('/Users/kauedesousa/Library/Mobile Documents/com~apple~CloudDocs/Work/Rcode/tricot-data-v1/output/bean-eastafrica/trial-network.png')
```

# Summary of variety performance

Table 1 presents the results of an analysis of variance (ANOVA), which tests the hypothesis that at least one variety in the set performs significantly better than the others. Traits with a p-value < 0.05 suggest that the observed performance differences are not due to random variation, indicating that at least one variety exhibits superior performance.


```{r ANOVA}
knitr::kable(output$anova, 
          caption = paste0("Table 1. Analysis of variance (ANOVA) for the performance of varieties tested in the experiment."),
          align = "l",
          row.names = FALSE)
```


Figure 3 illustrates the Kendall tau coefficients for the traits analyzed. Among the traits, 'marketability' exhibited the strongest correlation with 'overall preference' with an average Kendall $\tau$ = 0.65. In contrast, 'drought tolerance' showed the weakest correlation with 'overall preference,' with an average Kendall $\tau$ = 0.21. These results highlight the varying degrees of influence that specific traits have on participants' overall preferences.


```{r kendall_tau_plot, fig.height=7, fig.width=7, fig.cap=paste0("Fig. 3. Kendall correlation coefficient between overall preference and the other traits assessed in the experiment.")}
output$kendall
```

Figure 4 presents the log-worth by trait for each variety tested in this experiment. The worth map indicates, for each trait, the probability that a variety outperforms the others in the set. The worth parameters are adjusted to a logarithmic scale, where a log-worth > 0 (green) signifies superior performance for a given trait, while a log-worth < 0 (brown) indicates underperformance. This visualization effectively highlights the relative strengths and weaknesses of each variety across different traits.


```{r worthmap, fig.cap= paste0("Figure 4. Log-worth parameters for each variety tested in the experiment.")}
output$worth
```

# Variety performance within groups

Tables 2 and 3 present the effect of gender and region on generating distinguishable rankings, assessed using a likelihood ratio test. The results indicate that sub-setting the data by region produces statistically significant differences in rankings. This test can also be applied to validate more complex groupings, such as those derived from cluster analyses or farmer typologies that incorporate a diverse set of variables (e.g., socio-economic and agroecological factors), as outlined by Voss et al. (2024) [@Voss2024].

```{r llr1}
knitr::kable(output$llr_region, 
          caption = paste0("Table 2. Likelihood-ratio test within regions."),
          align = "l",
          row.names = FALSE)
```


```{r llr2}
knitr::kable(output$llr_gender, 
          caption = paste0("Table 2. Likelihood-ratio test within gender."),
          align = "l",
          row.names = FALSE)
```

Now, returning to the worth map analysis, we can visualize the performance of the varieties within the groups.

```{r worthmap2, fig.cap = paste0("Figure 5. Log-worth parameters for each variety tested in the experiment within regions.")}
output$worth_region
```

```{r worthmap3, fig.cap= paste0("Figure 6. Log-worth parameters for each variety tested in the experiment within gender.")}
output$worth_gender
```


# References

::: {#refs}
:::

